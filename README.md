# ğŸ¥ RTSP Livestream Overlay Web Application

A real-time web application for playing RTSP livestreams with customizable text and image overlays. Built with React, Flask, and MongoDB.

![Version](https://img.shields.io/badge/version-1.0.0-blue)
![Python](https://img.shields.io/badge/python-3.8+-green)
![React](https://img.shields.io/badge/react-19.2.0-blue)
![License](https://img.shields.io/badge/license-MIT-green)

---

## ğŸ“‹ Table of Contents

- [Features](#features)
- [Technology Stack](#technology-stack)
- [Project Structure](#project-structure)
- [Prerequisites](#prerequisites)
- [Installation](#installation)
- [Configuration](#configuration)
- [Running the Application](#running-the-application)
- [API Documentation](#api-documentation)
- [Usage Guide](#usage-guide)
- [Troubleshooting](#troubleshooting)

---

## âœ¨ Features

- âœ… **RTSP Stream Support** - Convert and play RTSP streams in browser
- âœ… **Real-time Overlays** - Add text and image overlays on video
- âœ… **Drag & Drop** - Freely position overlays anywhere on video
- âœ… **Resizable** - Adjust overlay size with mouse
- âœ… **Persistent Storage** - All overlays saved to MongoDB
- âœ… **Auto-save** - Changes automatically sync to database
- âœ… **Live Updates** - See changes in real-time
- âœ… **Video Controls** - Play, pause, volume, fullscreen

---

## ğŸ›  Technology Stack

### Backend
- **Python 3.8+** - Programming language
- **Flask 3.1.2** - Web framework
- **MongoDB 4.16+** - Database
- **FFmpeg** - RTSP to HLS conversion

### Frontend
- **React 19.2** - UI library
- **Vite 7.2** - Build tool
- **HLS.js 1.5** - Video streaming

---

## ğŸ“ Project Structure

```
livestream-overlay-app/
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app.py                 # Flask server & API endpoints
â”‚   â”œâ”€â”€ stream_rtsp.py         # RTSP to HLS converter
â”‚   â”œâ”€â”€ requirements.txt       # Python dependencies
â”‚   â””â”€â”€ stream/                # HLS output directory (auto-created)
â”‚       â”œâ”€â”€ stream.m3u8        # Generated by FFmpeg
â”‚       â””â”€â”€ stream*.ts         # Generated by FFmpeg
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ App.jsx           # Main React component
â”‚   â”‚   â””â”€â”€ main.jsx          # React entry point
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ package.json          # Node dependencies
â”‚   â”œâ”€â”€ vite.config.js        # Vite configuration
â”‚   â””â”€â”€ index.html            # HTML template
â”‚
â””â”€â”€ README.md                 # This file
```

---

## ğŸ“¦ Prerequisites

Before installation, ensure you have:

### 1. **Node.js & npm**
```bash
# Check installation
node --version  # Should be v18+ 
npm --version   # Should be v9+

# Download from: https://nodejs.org/
```

### 2. **Python 3.8+**
```bash
# Check installation
python --version  # or python3 --version

# Download from: https://www.python.org/downloads/
```

### 3. **MongoDB**
```bash
# Check installation
mongod --version

# Install:
# - Windows: https://www.mongodb.com/try/download/community
# - Mac: brew install mongodb-community
# - Linux: sudo apt-get install mongodb
```

### 4. **FFmpeg**
```bash
# Check installation
ffmpeg -version

# Install:
# - Windows: https://ffmpeg.org/download.html (add to PATH)
# - Mac: brew install ffmpeg
# - Linux: sudo apt-get install ffmpeg
```

---

## ğŸš€ Installation

### Step 1: Clone Repository
```bash
git clone <your-repository-url>
cd livestream-overlay-app
```

### Step 2: Backend Setup

```bash
# Navigate to backend
cd backend

# Create virtual environment (recommended)
python -m venv venv

# Activate virtual environment
# Windows:
venv\Scripts\activate
# Mac/Linux:
source venv/bin/activate

# Install dependencies
pip install -r requirements.txt

# Create stream directory
mkdir stream
```

### Step 3: Frontend Setup

```bash
# Navigate to frontend
cd ../frontend

# Install dependencies
npm install
```

---

## âš™ï¸ Configuration

### 1. MongoDB Configuration

**Start MongoDB:**
```bash
# Windows/Mac/Linux
mongod
```

**Verify Connection:**
```bash
# Open MongoDB shell
mongosh

# Check databases
show dbs
```

### 2. RTSP Source Configuration

Get a test RTSP stream from:
- **RTSP.me** - https://rtsp.me (Free temporary streams)
- **Wowza Test** - `rtsp://wowzaec2demo.streamlock.net/vod/mp4:BigBuckBunny_115k.mp4`
- Your own IP camera

---

## ğŸ¬ Running the Application

### Terminal 1: Start MongoDB
```bash
mongod
```

### Terminal 2: Start RTSP Stream Converter
```bash
cd backend

# Using test stream
python stream_rtsp.py rtsp://wowzaec2demo.streamlock.net/vod/mp4:BigBuckBunny_115k.mp4

# Using your RTSP URL
python stream_rtsp.py rtsp://username:password@camera-ip:554/stream

# Custom output directory
python stream_rtsp.py <RTSP_URL> custom_output_dir
```

**Expected Output:**
```
ğŸ¥ Starting RTSP to HLS conversion...
ğŸ“ RTSP URL: rtsp://...
ğŸ“‚ Output: stream/stream.m3u8

âš ï¸  Press Ctrl+C to stop streaming

ğŸ“Š frame= 1234 fps= 30 time=00:00:41.23 ...
```

### Terminal 3: Start Flask Backend
```bash
cd backend
python app.py
```

**Expected Output:**
```
 * Running on http://127.0.0.1:5000
 * Debug mode: on
```

### Terminal 4: Start React Frontend
```bash
cd frontend
npm run dev
```

**Expected Output:**
```
  VITE v7.2.4  ready in 543 ms

  âœ  Local:   http://localhost:5173/
  âœ  Network: use --host to expose
```

### Open Application
Navigate to: **http://localhost:5173**

---

## ğŸ“š API Documentation

### Base URL
```
http://localhost:5000
```

### Endpoints

#### 1. **Create Overlay**
```http
POST /overlays
Content-Type: application/json

{
  "type": "text",
  "content": "Hello World",
  "position": { "x": 100, "y": 50 },
  "size": { "width": 200, "height": 50 }
}
```

**Response:**
```json
{
  "id": "679a1b2c3d4e5f6789012345"
}
```

#### 2. **Get All Overlays**
```http
GET /overlays
```

**Response:**
```json
[
  {
    "_id": "679a1b2c3d4e5f6789012345",
    "type": "text",
    "content": "Hello World",
    "position": { "x": 100, "y": 50 },
    "size": { "width": 200, "height": 50 }
  }
]
```

#### 3. **Get Single Overlay**
```http
GET /overlays/:id
```

#### 4. **Update Overlay**
```http
PUT /overlays/:id
Content-Type: application/json

{
  "position": { "x": 150, "y": 100 }
}
```

**Response:**
```json
{
  "message": "Overlay updated successfully"
}
```

#### 5. **Delete Overlay**
```http
DELETE /overlays/:id
```

**Response:**
```json
{
  "message": "Overlay deleted successfully"
}
```

### Testing APIs with cURL

```bash
# Create overlay
curl -X POST http://localhost:5000/overlays \
  -H "Content-Type: application/json" \
  -d '{"type":"text","content":"Test","position":{"x":10,"y":20},"size":{"width":180,"height":50}}'

# Get all overlays
curl http://localhost:5000/overlays

# Update overlay (replace ID)
curl -X PUT http://localhost:5000/overlays/679a1b2c3d4e5f6789012345 \
  -H "Content-Type: application/json" \
  -d '{"content":"Updated Text"}'

# Delete overlay (replace ID)
curl -X DELETE http://localhost:5000/overlays/679a1b2c3d4e5f6789012345
```

---

## ğŸ“– Usage Guide

### 1. **Starting a Stream**

1. Obtain RTSP URL from your camera or test service
2. Run the RTSP converter: `python stream_rtsp.py <RTSP_URL>`
3. Wait for "Starting RTSP to HLS conversion..." message
4. Open the web application at http://localhost:5173

### 2. **Adding Text Overlays**

1. Click **"â• Add Text Overlay"** button
2. A new overlay appears on the video
3. Click to select the overlay (green border appears)
4. Type in the text editor at the bottom to change text
5. Changes save automatically

### 3. **Adding Image Overlays**

1. Click **"ğŸ–¼ï¸ Upload Image"** button
2. Select an image file from your computer
3. The image appears as an overlay on the video
4. Resize and position as needed

### 4. **Moving Overlays**

1. Click on any overlay to select it
2. Drag anywhere inside the overlay to move it
3. Position updates automatically save to database

### 5. **Resizing Overlays**

1. Select an overlay (click on it)
2. A green handle appears in the bottom-right corner
3. Drag the handle to resize
4. Size updates automatically save to database

### 6. **Deleting Overlays**

- **Delete Selected**: Click an overlay, then click "ğŸ—‘ï¸ Delete Selected"
- **Reset All**: Click "â™»ï¸ Reset All" to delete all overlays (requires confirmation)

---

## ğŸ”§ Troubleshooting

### Issue: "FFmpeg not found"
**Solution:**
```bash
# Windows
1. Download FFmpeg from https://ffmpeg.org/download.html
2. Extract to C:\ffmpeg
3. Add C:\ffmpeg\bin to PATH environment variable
4. Restart terminal

# Mac
brew install ffmpeg

# Linux
sudo apt-get update
sudo apt-get install ffmpeg
```

### Issue: "MongoDB connection failed"
**Solution:**
```bash
# Check if MongoDB is running
mongod --version

# Start MongoDB
mongod

# Verify connection
mongosh
> show dbs
```

### Issue: "Video not playing"
**Solutions:**
1. Verify RTSP converter is running
2. Check stream files exist: `backend/stream/stream.m3u8`
3. Check browser console for errors (F12)
4. Try a different RTSP URL (test with Wowza URL)

### Issue: "CORS errors"
**Solution:** Flask-CORS is already configured. If issues persist:
```python
# In app.py, replace:
CORS(app)

# With:
CORS(app, resources={r"/*": {"origins": "*"}})
```

### Issue: "Overlays not saving"
**Solution:**
1. Check MongoDB is running
2. Verify backend API is accessible: http://localhost:5000/overlays
3. Check browser console for network errors

---

## ğŸ¯ Demo Video Requirements

Record a screen capture demonstrating:

1. âœ… Starting all services (MongoDB, FFmpeg, Flask, React)
2. âœ… Video playing from RTSP source
3. âœ… Creating text overlay
4. âœ… Editing text content
5. âœ… Moving overlay (drag)
6. âœ… Resizing overlay
7. âœ… Uploading image overlay
8. âœ… Deleting overlay
9. âœ… Showing MongoDB data persistence (refresh page)

**Tools:** OBS Studio, QuickTime, Windows Game Bar

---

## ğŸ“ License

MIT License - Feel free to use for learning and projects.

---

## ğŸ‘¥ Contributors

- Your Name - Initial work

---

## ğŸ“§ Support

For issues or questions:
- Email: rakesh@gonote.ai
- CC: safiya@gonote.ai, aman@gonote.ai

---

## ğŸ™ Acknowledgments

- FFmpeg community
- React team
- MongoDB team
- Flask team

---

**Built with â¤ï¸ for real-time video streaming**
